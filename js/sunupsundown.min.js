var sunupsundown=function(){function getLatLng(){navigator.geolocation.getCurrentPosition(geoSuccess,geoError)}function geoError(){console.log("Sorry, your current location cannot be found.")}function geoSuccess(location){var loc={lat:location.coords.latitude,lng:location.coords.longitude},evt=document.createEvent("CustomEvent");evt.initCustomEvent("locationReported",!0,!0,loc),window.dispatchEvent(evt)}function buildXHR(lat,lng){var currentDate=new Date,day=currentDate.getDate(),mon=currentDate.getMonth(),utcOffset=createOffset(currentDate);return"http://www.earthtools.org/sun/"+lat+"/"+lng+"/"+day+"/"+mon+"/"+utcOffset+"/0"}function createOffset(date){var sign=date.getTimezoneOffset()>0?"-":"";return sign+Math.floor(Math.abs(date.getTimezoneOffset())/60)}function getSunUpSunDown(urlToFetch){var urlForYQL="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'"+encodeURIComponent(urlToFetch)+"'&format=json";request=new XMLHttpRequest,request.open("GET",urlForYQL,!0),request.onload=function(){request.status>=200&&request.status<400?(data=JSON.parse(request.responseText),sunData=data.query.results.sun,sunUp=formatSunObjTime(sunData.morning.sunrise,sunData.date),firstLight=getOffsetTime(sunUp,-30),sunDown=formatSunObjTime(sunData.evening.sunset,sunData.date),lastLight=getOffsetTime(sunDown,30),toggleClass("loading",sunInfoEl),updateDOMTime("first-light",firstLight),updateDOMTime("sunrise",sunUp),updateDOMTime("sunset",sunDown),updateDOMTime("last-light",lastLight),toggleClass("animated","#sunup h1, #sundown h1, #first-light, #sunrise, #sunset, #last-light"),toggleClass("fadeInDown","#sunup h1, #sundown h1"),toggleClass("fadeInUp","#first-light, #sunrise, #sunset, #last-light")):console.log("Sorry, the EarthTools service returned an error: "+request.status)},request.onerror=function(){console.log("Sorry, there was an error establishing a connection to the EarthTools service.")},request.send()}function formatSunObjTime(sunObj,sunObjDate){var time=sunObj,day=sunObjDate.day,mon=sunObjDate.month,year=(new Date).getFullYear(),formattedDate=year+"-"+mon+"-"+day;return sunObjTime=new Date(formattedDate+" "+time)}function getOffsetTime(firstTime,offset){var newTime=new Date(firstTime);return newTime.setMinutes(firstTime.getMinutes()+offset),newTime}function updateDOMTime(el,timeObj){var timeEl=document.getElementById(el),timeTag=timeEl.getElementsByTagName("time"),timeHour=(timeObj.getHours()<10?"0":"")+timeObj.getHours(),timeMin=(timeObj.getMinutes()<10?"0":"")+timeObj.getMinutes(),timeAmPm=12>timeHour?"am":"pm";timeTag[0].setAttribute("datetime",timeObj.toISOString()),timeTag[0].innerHTML=timeHour+":"+timeMin+"<span class='ampm'>"+timeAmPm+"</span>"}function toggleClass(className,elName){for(var els=document.querySelectorAll(elName),i=els.length-1;i>=0;i--){var el=els[i];if(el.classList)el.classList.toggle(className);else{for(var existingIndex=-1,j=classes.length;j--;)classes[j]===className&&(existingIndex=j);existingIndex>=0?classes.splice(existingIndex,1):classes.push(className),el.className=classes.join(" ")}}}var firstLight,sunUp,sunDown,lastLight,sunInfoEl=".sun-info";window.addEventListener("locationReported",function(evt){var urlToFetch=buildXHR(evt.detail.lat,evt.detail.lng);getSunUpSunDown(urlToFetch)},!1),getLatLng()}();